<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="common_content(title)">
	<div class="container">
		<div class="input-form-backgroud row">
			<div class="input-form col-md-12 mx-auto">

				<!--				<h4 class="mb-3">[[${title}]]</h4>-->
				<h4 class="mb-3"></h4>

				<!--지역 버튼 시작 -->
				<div id="regionSelection">
					<button class="btn-sm btn-outline-primary AllRegionBtn" id="AllRegionBtn" value="축제">전국</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="seoulBtn" value="서울">서울</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="busanBtn" value="부산">부산</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="daeguBtn" value="대구">대구</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="incheonBtn" value="인천">인천</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="gwangjuBtn" value="광주">광주</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="daejeonBtn" value="대전">대전</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="ulsanBtn" value="울산">울산</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="sejongBtn" value="세종">세종</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="gyeonggiBtn" value="경기">경기</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="gangwonBtn" value="강원">강원</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="chungbukBtn" value="충청북도">충북</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="chungnamBtn" value="충청남도">충남</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="gyeongbukBtn" value="경상북도">경북</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="gyeongnamBtn" value="경상남도">경남</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="jeonbukBtn" value="전라북도">전북</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="jeonnamBtn" value="전라남도">전남</button>
					<button class="btn-sm btn-outline-primary regionBtn" id="jejuBtn" value="제주">제주</button>
				</div>
				<!--									지역 버튼 끝-->

				<!-- Search Form start-->
				<div class="mb-5">
					<div class="bg-white" style="padding: 30px;">
						<div class="input-group" style="justify-content: flex-end;">
							<form class="form-inline my-2 my-lg-0 justify-content-end" action="festivalSearchList">
								<select class="selectpicker" name="searchKey">
									<option value="festivalName">축제이름</option>
									<option value="address">주소</option>
								</select>

								<input class="form-control mr-sm-2" type="search" placeholder="Search"
									aria-label="Search" name="searchWord" value="">
								<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
							</form>
						</div>
					</div>
					<!-- Search Form end-->

					<!--					테이블 시작-->
					<!--					<table class="table">-->
					<!--						<thead>-->
					<!--							<tr>-->
					<!--								<th scope="col">festivalNum</th>-->
					<!--								<th scope="col">festivalName</th>-->
					<!--								<th scope="col">festivalAddress</th>-->
					<!--								<th scope="col">festivalContent</th>-->
					<!--								<th scope="col">festivalStart</th>-->
					<!--								<th scope="col">festivalFinal</th>-->
					<!--								<th scope="col">festivalViews</th>-->
					<!--								<th scope="col">festivalThumbUp</th>-->
					<!--								<th scope="col">festivalImg</th>-->
					<!--								<th scope="col"></th>-->

					<!--							</tr>-->
					<!--						</thead>-->
					<!--						<tbody>-->
					<!--							<th:block th:each="vo : ${vos}">-->
					<!--								<tr>-->
					<!--									<th scope="row"><a th:href="@{|festivalSelectOne?festivalNum=${vo.festivalNum}|}">-->
					<!--										<span th:text="${vo.festivalNum}"></span></a></th>-->
					<!--									<td><a th:href="@{|festivalSelectOne?festivalNum=${vo.festivalNum}|}"><span-->
					<!--												th:text="${vo.festivalName}"></span></a></td>-->
					<!--									<td><span th:text="${vo.festivalAddress}"></span></td>-->
					<!--									<td><span th:text="${vo.festivalContent}"></span></td>-->
					<!--									<td><span th:text="${vo.festivalStart}"></span></td>-->
					<!--									<td><span th:text="${vo.festivalFinal}"></span></td>-->
					<!--									<td><span th:text="${vo.festivalUsetime}"></span></td>-->
					<!--									<td><span th:text="${vo.festivalViews}"></span></td>-->
					<!--									<td><span th:text="${vo.festivalThumbUp}"></span></td>-->
					<!--									<td><span th:text="${vo.festivalImg}"></span></td>-->
					<!--									<td><a th:href="@{|festivalDelete?festivalNum=${vo.festivalNum}|}"><span>delete</span></a></td>-->
					<!--								</tr>-->

					<!--							</th:block>-->
					<!--						</tbody>-->
					<!--						<tfoot>-->
					<!--							<tr>-->
					<!--								<td colspan="6">-->
					<!--									<th:block th:each="i : ${#numbers.sequence(1,totalPageCount)}">-->
					<!--										<th:block th:if="${param.searchKey}== null">-->
					<!--											<a th:href="|festivalSelectAll?cpage=${i}|">[[${i}]] &nbsp;</a>-->
					<!--										</th:block>-->
					<!--										<th:block th:if="${param.searchKey}!= null">-->
					<!--											<a-->
					<!--												th:href="@{festivalSearchList(cpage=${i},searchKey=${param.searchKey},searchWord=${param.searchWord})}">[[${i}]]-->
					<!--												&nbsp;</a>-->
					<!--										</th:block>-->
					<!--									</th:block>-->
					<!--								</td>-->
					<!--							</tr>-->
					<!--						</tfoot>-->
					<!--					</table>-->
					<!--테이블끝-->
					<!-- 축제목록 start-->

					<div class="container-fluid py-5">
						<div class="container pt-5 pb-3">
							<div class="text-center mb-3 pb-3">
								<h6 class="text-primary text-uppercase" id="festivalDestination"
									style="letter-spacing: 5px;">전국</h6>
								<h1>축제 목록</h1>




								<!--</form>-->
							</div>
							<div class="row" id="destinationList">
								<th:block th:each="vo : ${vos}">
									<div class="col-lg-4 col-md-6 mb-4">
										<div class="destination-item position-relative overflow-hidden mb-2">
											<!--										<img class="img-fluid" src="/img/destination-1.jpg" alt="">-->
											<img class="img-fluid" style="max-width: 100%; height: auto;"
												th:if="${vo.festivalImg == null or vo.festivalImg == ''}"
												src="/img/destination-1.jpg" alt="기본이미지대체텍스트" />
											<!-- 이미지가 비어 있지 않은 경우에는 해당 이미지를 사용 -->
											<img class="img-fluid" style="max-width: 100%; height: auto;"
												th:if="${vo.festivalImg != null and vo.festivalImg != ''}"
												th:src="${vo.festivalImg}" alt="이미지대체텍스트" />
											<!--										<img class="img-fluid" th:src="${vo.festivalImg}" alt="">-->

											<a class="destination-overlay text-white text-decoration-none"
												th:href="@{|/festival/festivalDetails?festivalNum=${vo.festivalNum}|}">
												<h5 class="text-white"><span th:text="${vo.festivalAddress}"></span>
												</h5>
												<span th:text="${vo.festivalName}"></span>
											</a>
										</div>
									</div>

								</th:block>
								<div class="col-12" id="" pagination>
									<nav aria-label="Page navigation">
										<ul class="pagination pagination-lg justify-content-center bg-white mb-0"
											style="padding: 30px;">

											<th:block th:each="i : ${#numbers.sequence(1,totalPageCount)}">
												<th:block th:if="${param.searchKey}== null">
													<li class="page-item"><a class="page-link"
															th:href="@{/festival/festivalSelectAll(cpage=${i})}">[[${i}]]</a>
													</li>
												</th:block>
												<th:block th:if="${param.searchKey}!= null">
													<li class="page-item"><a class="page-link"
															th:href="@{/festival/festivalSearchList(cpage=${i},searchKey=${param.searchKey},searchWord=${param.searchWord})}">[[${i}]]</a>
													</li>
												</th:block>
											</th:block>

										</ul>
									</nav>
								</div>


								<script th:inline="javascript">

									//지역목록 시작
									$(".regionBtn").click(function () {
										let region = $(this).val();
										console.log(region);

										sendToControllerForUpdate(region);
										changeRegionText(region);
									});
									function changeRegionText(region) {
										// 선택한 지역으로 "축제" 텍스트를 변경합니다.
										document.getElementById('festivalDestination').innerHTML = region;
									}
									function sendToControllerForUpdate(region) {

										let data = {searchKey: "festivalAddress", searchWord: region, cpage: "1", pageBlock: "6"};
										$.ajax({
											url: '/festival/searchRegion',
											type: 'POST',
											contentType: 'application/json',
											data: JSON.stringify(data),
											success: function (response) {
												console.log('서버 응답:', response);

												//vos = response;
												updateHTMLWithVos(response);



											},
											error: function (xhr, status, error) {
												console.error('서버 요청 오류:', error);
											}
										});
									}

									function updateHTMLWithVos(vos) {
										// vos를 이용하여 HTML을 업데이트
										let destinationHTML = '';
										for (let i = 0; i < vos.length; i++) {
											let vo = vos[i];
											if (!vo.festivalImg) {
												// 이미지가 비어 있는 경우 기본 이미지로 대체하여 표시
												destinationHTML += `
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="destination-item position-relative overflow-hidden mb-2">
                        <img class="img-fluid" src="/img/destination-1.jpg" style="max-width: 100%; height: auto;" alt="기본이미지 대체 텍스트">
                        <a class="destination-overlay text-white text-decoration-none"
                            href="/festival/festivalDetails?festivalNum=${vo.festivalNum}">
                            <h5 class="text-white">${vo.festivalName}</h5>
                            <span>${vo.festivalAddress}</span>
                        </a>
                    </div>
                </div>`;
											} else {
												// 이미지가 비어 있지 않은 경우에는 해당 이미지를 사용
												destinationHTML += `
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="destination-item position-relative overflow-hidden mb-2">
                        <img class="img-fluid" src="${vo.festivalImg}" style="max-width: 100%; height: auto;" alt="">
                        <a class="destination-overlay text-white text-decoration-none"
                            href="/festival/festivalDetails?festivalNum=${vo.festivalNum}">
                            <h5 class="text-white">${vo.festivalName}</h5>
                            <span>${vo.festivalAddress}</span>
                        </a>
                    </div>
                </div>`;
											}
										}
										// vos를 반영할 HTML 요소에 할당
										document.getElementById('destinationList').innerHTML = destinationHTML;
									}

									// 전국 버튼에 클릭 이벤트 핸들러 추가
									$("#AllRegionBtn").click(function () {
										// 전체 페이지 새로고침
										window.location.reload();
										// 또는 다른 URL로 이동
										// window.location.href = "/festival/festivalSelectAll";
									});

								</script>
							</div>
						</div>
					</div>
				</div>

</html>