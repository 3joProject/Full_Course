<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Admin Chat Room</title>
    <script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>
    <script th:inline="javascript">
        var roomId = "[[${chatRoom.chatRoomId}]]"; // 채팅방 ID
        var stompClient = null;

        function connect() {
            var socket = new SockJS('/ws');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function(frame) {
                console.log('Connected: ' + frame);
                stompClient.subscribe('/topic/' + roomId, function(message) {
                    showMessage(JSON.parse(message.body));
                });
            });
        }

        function showMessage(message) {
            var chatMessages = document.getElementById('chat-messages');
            var messageElement = document.createElement('div');
            messageElement.textContent = message.sender + ': ' + message.message;
            chatMessages.appendChild(messageElement);
        }

        function sendMessage() {
            var messageInput = document.getElementById('messageInput');
            var message = messageInput.value.trim();
            if (message && stompClient) {
                var chatMessage = {
                    sender: 'Admin',
                    message: message,
                    chatRoomId: roomId
                };
                stompClient.send("/app/chat/" + roomId, {}, JSON.stringify(chatMessage));
                messageInput.value = '';
            }
        }

        document.addEventListener('DOMContentLoaded', connect);
    </script>
</head>
<body>
    <h1>Chat Room #<span th:text="${chatRoom.chatRoomId}"></span></h1>
    <div id="chat-messages"></div>
    <input type="text" id="messageInput" placeholder="Type your message here...">
    <button onclick="sendMessage()">Send</button>
</body>
</html>
